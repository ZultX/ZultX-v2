<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ZultX ‚Äî Adaptive Reasoning AI</title>
<meta name="description" content="ZultX is Adaptive Reasoning AI system focused on very complex reasoning, friendly, and intelligent conversation." />
<meta name="robots" content="index, follow" />
<meta name="google-site-verification" content="ZPjCIwA1WKlXdH9n68BLts7CbCRwKlmwgymRsyWMawU" />
<link rel="canonical" href="https://zultx.github.io/ZultX-v2/" />
<link rel="preconnect" href="https://zultx.onrender.com">
<link rel="dns-prefetch" href="https://zultx.onrender.com">
<link rel="icon" href="favicon.ico" type="image/x-icon">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<meta property="og:site_name" content="ZultX">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<script type="application/ld+json">
{ 
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "ZultX",
  "alternateName": "Zultx",
  "url": "https://zultx.github.io/ZultX-v2/"
}
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9101851301102739"
     crossorigin="anonymous"></script>

<style>
:root{
  --bg:#0b0b0f;
  --muted:#9aa0a6;
  --text:#e8eaed;
  --accent:#f3d36b; /* golden-ish */
  --accent-strong:#ffd54a;
  --accent-dark:#b8860b;
  --outline:#1a1a1a;
  --side-w:320px;
  --header-h:72px;
  --card-bg: linear-gradient(180deg,#0e141c,#070c12);
  --glass: rgba(255,255,255,0.03);
}

/* Light theme overrides */
@media (prefers-color-scheme: light){
  :root{
    --bg:#ffffff;
    --muted:#6b7280;
    --text:#0b1220;
    --accent:#b58100;
    --accent-strong:#c89b14;
    --outline:#e6e6e6;
    --card-bg: linear-gradient(180deg,#ffffff,#fafafa);
    --glass: rgba(0,0,0,0.04);
  }
}

/* Manual theme class (overrides media) */
html.light {
  --bg:#ffffff; --muted:#6b7280; --text:#0b1220; --outline:#e6e6e6; --card-bg: linear-gradient(180deg,#ffffff,#fafafa);
}
html.dark {
  --bg:#0b0b0f; --muted:#9aa0a6; --text:#e8eaed; --outline:#141416; --card-bg: linear-gradient(180deg,#0e141c,#070c12);
}

/* Reset + base */
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;color:var(--text);background:var(--bg);-webkit-font-smoothing:antialiased}
a{color:inherit}

/* Header */
header{
  position:fixed;
  top:0;
  left:0;
  right:0;
  height:var(--header-h);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px 14px;
  background: rgba(255,255,255,0.78);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  color:var(--text);
  box-shadow: 0 6px 24px rgba(0,0,0,0.06);
  border-bottom:1px solid rgba(255,255,255,0.06);
  z-index:9999;
}
  
.app{
  display:flex;
  min-height:100vh;
  padding-top:var(--header-h);
  position:relative;
}

.logo{font-weight:900;display:flex;align-items:center;font-size:20px}
.logo .fire{background:linear-gradient(90deg,#ff3b3b,#ff8a00);-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:900}
.logo .x-black{margin-left:6px;background:var(--outline);color:var(--text);padding:4px 8px;border-radius:8px;font-size:14px;font-weight:800}

/* header right actions */
.header-actions{display:flex;gap:10px;align-items:center}
.top-tip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:var(--glass);cursor:pointer}
.version-badge{font-size:13px;color:var(--muted)}
html.dark header{
  background: rgba(15,23,32,0.78);
}

/* Temp chat icon (3/4 circle) */
.temp-chat-icon{
  width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;
  border:2px solid rgba(255,255,255,0.06);background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
  position:relative;font-weight:700;font-size:15px;
}
.temp-chat-icon svg{width:20px;height:20px;display:block;}

/* App layout */
.side{
  position:fixed;
  top:var(--header-h);
  left:0;
  width:var(--side-w);
  height:calc(100vh - var(--header-h));
  background:linear-gradient(180deg,#08090a,#0b0b0b);
  border-right:1px solid rgba(255,255,255,0.03);
  scrollbar-width: thin;
  padding:14px;
  overflow-y:auto;
  z-index:9000;
}
.side::-webkit-scrollbar{
  width:6px;
}
.side::-webkit-scrollbar-thumb{
  background:rgba(255,215,0,0.2);
  border-radius:6px;
}
.menu-btn{display:flex;align-items:center;gap:8px;padding:10px;border-radius:10px;cursor:pointer;background:var(--glass)}
.main{
  flex:1;
  display:flex;
  flex-direction:column;
  position:relative;
  margin-left:var(--side-w);
}
.mobile-only{ display:none; }

@media (max-width:880px){
  .mobile-only{ display:inline-flex; }
}
.side-actions{
  display:flex;
  gap:10px;
  margin:14px 0 18px 0;
  flex-wrap:wrap;
}

.side-btn{
  width:42px;
  height:42px;
  border-radius:12px;
  background:rgba(255,255,255,0.06);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  font-size:18px;
  transition:.2s ease;
  backdrop-filter:blur(6px);
}

.side-btn:hover{
  background:rgba(255,255,255,0.15);
  transform:translateY(-2px);
}
html.light .side-btn{
  background:#f0f0f0;
}

html.light .side-btn:hover{
  background:#e2e2e2;
}

/* center initial screen with suggestion cards */
.center-screen{flex:1;display:flex;align-items:center;justify-content:center;color:var(--muted);padding:40px}
.center-inner{max-width:880px;text-align:center}
.center-title{font-size:30px;font-weight:900;margin-bottom:18px;color:var(--text)}
.suggest-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px;margin-top:8px}
.suggest-card{padding:16px;border-radius:14px;cursor:pointer;background:var(--card-bg);border:1px solid rgba(255,215,0,0.06);color:var(--text);font-weight:700;transition:all .18s ease;box-shadow:0 6px 22px rgba(0,0,0,0.25)}
.suggest-card:hover{transform:translateY(-6px);box-shadow:0 20px 40px rgba(0,0,0,0.45);outline:3px solid rgba(255,215,0,0.06)}
.start-btn{margin-top:20px;padding:12px 22px;border-radius:999px;border:1px solid var(--outline);background:transparent;color:var(--text);cursor:pointer}

/* chat area */
.chat-wrap{display:flex;flex-direction:column;gap:12px;padding:18px;max-width:980px;margin:0 auto;flex:1;overflow:auto}
.msg{
  padding:12px 16px;
  border-radius:14px;
  max-width:78%;
  line-height:1.45;
}
.msg.user{
  white-space: pre-wrap;
}
.side{
  box-shadow:none;
}

.msg.user{background:linear-gradient(180deg,#071326,#04101a);margin-left:auto;border-top-right-radius:6px;color:#cfe7ff;border-right:4px solid var(--accent-strong)}
.msg.ai{background:linear-gradient(180deg,#0f1720,#07101a);margin-right:auto;border-top-left-radius:6px;color:#eef6ff;border-left:4px solid var(--accent-strong)}

/* gold bubble highlight for light theme */
html.light .msg.user{background:linear-gradient(180deg,#fff,#fbfbfb);color:var(--text);border-right:4px solid var(--accent)}
html.light .msg.ai{background:linear-gradient(180deg,#f7f7f7,#efefef);color:var(--text);border-left:4px solid var(--accent)}

/* compose area */
.compose {
  position: sticky;
  padding:14px;
  bottom: 0;
  background: var(--bg);
  display:flex;
  justify-content:center;
  z-index: 80;
}
  
.compose-inner{
  display:flex;
  align-items:center;
  gap:8px;
  width:100%;
  max-width:820px;
  background:rgba(255,255,255,0.06);
  border-radius:999px;
  padding:6px 10px;
  backdrop-filter:blur(10px);
}

.compose textarea{
  flex:1;
  background:transparent;
  border:none;
  padding:10px;
  border-radius:999px;
  min-height:40px;
  resize:none;
}

.compose textarea:focus{
  outline:none;
  box-shadow:none;
}

.compose button{
  border-radius:999px;
  padding:8px 16px;
}


@media (min-width:1600px){
  .premium-card{
    max-width:1100px;
  }
}
.compose button:disabled{
  opacity:0.6;
  cursor:not-allowed;
}

/* history */
.history-item{padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.02);cursor:pointer;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}
.history-item .meta{font-size:12px;color:var(--muted)}

/* small text */
.hint{color:var(--muted);font-size:13px;text-align:center;margin-top:8px}
.small-muted{font-size:12px;color:var(--muted)}

/* modals */
.modal{
  display:none;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  width:min(90vw, 700px);
  max-height:85vh;
  overflow:auto;
  background:var(--card-bg);
  border-radius:16px;
  padding:22px;
  z-index:15000;
  border:1px solid rgba(255,255,255,0.05);
}
.modal.sm{width:420px;left:calc(50% - 210px);right:auto}
#shareBtn:hover{
  box-shadow:0 0 16px rgba(255,215,0,0.25);
}
/* Glow effect for all top header buttons */
.header-actions .top-tip:hover,
.header-actions #lettersBtn:hover,
.header-actions #themeToggle:hover,
.temp-chat-icon:hover{
  box-shadow: 0 0 16px rgba(255,215,0,0.28);
  transform: translateY(-1px);
}
.header-actions .top-tip,
.header-actions #lettersBtn,
.temp-chat-icon{
  transition: box-shadow .18s ease, transform .18s ease;
}
/* Markdown formatting */
.msg.ai h1, .msg.ai h2, .msg.ai h3 {
  margin: 12px 0 8px;
  font-weight: 900;
}
@media (min-width:1600px){
  header{
    padding:14px 40px;
  }
}

.msg.ai table {
  width: 100%;
  border-collapse: collapse;
  margin: 12px 0;
  display: block;
  overflow-x: auto;
}

.msg.ai th, .msg.ai td {
  border: 1px solid rgba(255,255,255,0.12);
  padding: 8px 10px;
  text-align: left;
  white-space: nowrap;
}

.msg.ai th {
  background: rgba(255,215,0,0.08);
  font-weight: 800;
}

/* Code blocks */
/* Default (LIGHT THEME) */
.msg.ai pre{
  background: #f8f9fb;
  color: #1e1e1e;
  border-radius: 12px;
  padding: 14px;
  overflow-x: auto;
  font-size: 0.95em;
  border: 1px solid rgba(0,0,0,0.06);
}

/* DARK THEME */
html.dark .msg.ai pre{
  background: #0f1720;
  color: #e5e7eb;
  border: 1px solid rgba(255,255,255,0.08);
}
.msg.ai pre {
  position: relative;
}

.msg.ai pre::before {
  content: attr(data-lang);
  position: absolute;
  top: 6px;
  left: 10px;
  font-size: 11px;
  font-weight: 800;
  color: #22c55e;
}
.msg{
  transition: transform .15s ease, box-shadow .15s ease;
}
.file-preview-container{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:8px;
}
.chat-wrap{
  scroll-behavior: smooth;
  overflow-y: auto;
}
.file-pill{
  display:flex;
  align-items:center;
  gap:8px;
  background:#1a73e8;
  color:white;
  padding:6px 12px;
  border-radius:14px;
  font-size:13px;
  font-weight:600;
  animation: fadeInFile 0.2s ease;
}

.file-pill button{
  background:transparent;
  border:none;
  color:white;
  font-size:14px;
  cursor:pointer;
}

@keyframes fadeInFile{
  from{ opacity:0; transform:translateY(-4px);}
  to{ opacity:1; transform:translateY(0);}
}
  
@media (max-width:600px){
  .modal{
    left:4%;
    right:4%;
    top:8%;
    bottom:8%;
  }

  .modal.sm{
    width:auto;
    left:6%;
    right:6%;
  }

  .premium-card{
    padding:18px;
  }
}

/* Inline code ‚Äì green and readable */
.msg.ai p code {
  background: rgba(34,197,94,0.15);
  color: #15803d;
  padding: 2px 6px;
  border-radius: 6px;
  font-size: 0.95em;
  font-weight: 500;
}
html.dark .ai-pulse{
  box-shadow: 0 0 6px rgba(255,255,255,0.08);
}

html.dark .msg.ai p code {
  background: rgba(34,197,94,0.25);
  color: #4ade80;
}

/* Let highlight.js control BLOCK code colors */
.msg.ai pre code {
  color: inherit;
}




.msg.ai table {
  background: linear-gradient(180deg, rgba(255,255,255,0.03), transparent);
  border-radius: 12px;
  overflow: hidden;
}

.msg.ai tr:nth-child(even) td {
  background: rgba(255,255,255,0.02);
}

.msg.ai tr:hover td {
  background: rgba(255,215,0,0.06);
}
.msg.ai blockquote{
  border-left:4px solid var(--accent);
  padding:10px 14px;
  margin:12px 0;
  background: rgba(255,215,0,0.06);
  border-radius:10px;
  font-style:italic;
}
.msg.ai ul, .msg.ai ol{
  padding-left:22px;
  margin:10px 0;
}

.msg.ai li{
  margin:6px 0;
}

  
/* Copy button */
.copy-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  background: rgba(255,215,0,0.15);
  border: none;
  color: #ffd54a;
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 8px;
  cursor: pointer;
  }

/* Premium full-screen modal (golden) */
.premium-modal{
  display:none;
  position:fixed;
  inset:0;
  background: linear-gradient(180deg, rgba(12,8,6,0.94), rgba(16,12,10,0.96));
  z-index:20000;
  align-items:center;
  justify-content:center;
  padding:28px;
  backdrop-filter: blur(8px);
}
.premium-modal.active{
  display:flex;
}
  
.premium-card {
  width:100%;
  max-width:920px;
  border-radius:18px;
  padding:28px;
  background: linear-gradient(180deg, rgba(255,250,240,0.03), rgba(255,244,200,0.02));
  border: 1px solid rgba(255,215,0,0.18);
  box-shadow: 0 30px 80px rgba(0,0,0,0.6), 0 2px 12px rgba(255,215,0,0.04) inset;
  color: var(--text);
}
.premium-header { display:flex;justify-content:space-between;align-items:center;gap:12px; }
.premium-title { font-size:28px;font-weight:900;color:var(--accent-strong); }
.premium-sub { color:var(--muted); font-size:14px; }
body{
  padding-bottom: env(safe-area-inset-bottom);
}

/* form */
.premium-form { margin-top:18px; display:flex;flex-direction:column; gap:12px; }
.premium-form input {
  padding:12px;
  border-radius:10px;
  border:1px solid rgba(255,215,0,0.3);
  background:var(--bg);
  color:var(--text);
  font-weight:600;
  }
.premium-actions { display:flex; gap:10px; margin-top:10px; align-items:center; }

/* eye toggle button */
.pw-eye { background:transparent;border:none;color:var(--accent-strong); cursor:pointer; padding:8px;border-radius:8px; }
@media (max-width:600px){
  .msg{
    max-width:92%;
    font-size:15.5px;
  }
}

/* left-panel account line styling */
.side .account-row { padding:8px 10px; margin-bottom:12px; display:flex;justify-content:space-between;align-items:center; border-radius:8px; background:rgba(255,255,255,0.01); }
.account-btn { padding:8px 12px; border-radius:999px; cursor:pointer; font-weight:800; }
.account-btn.login { background: #0f7f3e; color: #fff; border:1px solid rgba(255,255,255,0.04); }
.account-btn.logout { background: #7a1f1f; color:#fff; border:1px solid rgba(255,255,255,0.04); }
.account-welcome { color: var(--muted); font-size:13px; }
.premium-actions button,
.premium-form .menu-btn {
  background: #ffffff;
  color: #111;
  font-weight:800;
  }
  
.suggest-card{
  font-size:16px;
  font-weight:500;
  letter-spacing:0.3px;
}

.suggest-card:hover{
  background:rgba(255,255,255,0.15);
  transform:translateY(-2px);
}

.msg.ai.thinking{
  display:flex;
  align-items:center;
  min-height:38px;
  padding:12px 16px;
  opacity:0.85;
  transition: opacity 0.25s ease, transform 0.2s ease;
}
.compose{
  position:relative;
  z-index:5;
}

.msg.ai.thinking .ai-pulse{
  margin:4px 0;
}
.msg.ai{
  animation: bubbleIn 0.25s ease-out;
}
@media (max-width:600px){
  :root{
    --header-h:58px;
  }

  header{
    padding:8px 12px;
  }

  .logo{
    font-size:17px;
  }

  .version-badge{
    display:none;
  }
}

@keyframes bubbleIn{
  from{
    transform: translateY(6px);
    opacity:0;
  }
  to{
    transform: translateY(0);
    opacity:1;
  }
}
.ai-pulse{
  width:14px;
  height:14px;
  border-radius:50%;
  background:#111;
  animation: pulseSlow 1.6s ease-in-out infinite;
  transition: background 0.3s ease;
}

.msg.ai.thinking.fast .ai-pulse{
  animation: pulseFast 1.1s ease-in-out infinite;
}

@keyframes pulseSlow{
  0%{ transform: scale(1); opacity:0.6; }
  50%{ transform: scale(1.4); opacity:1; }
  100%{ transform: scale(1); opacity:0.6; }
}

@keyframes pulseFast{
  0%{ transform: scale(1); opacity:0.6; }
  50%{ transform: scale(1.35); opacity:1; }
  100%{ transform: scale(1); opacity:0.6; }
}
@media (max-width:768px){
  .logo{
    display:none;
  }
      }
/* Premium Close Button Override */
#premiumClose {
  background: linear-gradient(90deg,#ffffff,#fff6cc);
  color:#111;
  font-weight:800;
}

#premiumClose:hover {
  background: #f3d36b;
  color: #000;
  }

.thinking-orbs{
  display:flex;
  align-items:center;
  justify-content:flex-start;
  margin:6px 0 6px 8px;
  height:26px;
}
@media (max-width:600px){
  .compose{
    position:sticky;
    bottom:0;
    background:var(--bg);
    padding:10px;
  }

  .chat-wrap{
    padding-bottom:90px;
  }
}
@media (hover:hover){
  .msg:hover{
    transform: translateY(-1px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.25);
  }
}

.token-counter{
  font-size:12px;
  opacity:0.6;
  text-align:right;
  margin-top:4px;
}
  
html.light .ai-pulse{
  background:#222;
}
@media (max-width:880px){
  .side{
    position:fixed;
    left:-320px;
    transition:left .3s ease;
    z-index:10000;
  }

  .side.open{
    left:0;
  }
}
.modern-compose:focus-within{
  box-shadow: 0 10px 40px rgba(0,0,0,0.4);
  transform: translateY(-1px);
  transition: all 0.2s ease;
}
  
@media (max-width:768px){

  header{
    background:transparent;
    box-shadow:none;
    border:none;
  }

  .logo,
  .small-muted,
  .version-badge{
    display:none;
  }

  .header-actions{
    width:100%;
    justify-content:space-between;
  }

  .top-tip strong{
    display:none;
  }

  .top-tip{
    padding:6px 10px;
    font-size:14px;
  }

  #mobileMenuBtn{
    display:flex !important;
  }

  .side{
    width:260px;
  }

  .main{
    margin-left:0;
  }

  .center-title{
    font-size:22px;
  }

  .suggest-card{
    padding:14px;
    font-size:15px;
  }

  .compose{
    padding:10px;
  }

  .compose textarea{
    font-size:15px;
  }
  .header-actions{
  display:none;
  }
      }

.header-actions > *{
  backdrop-filter:blur(6px);
  border:1px solid rgba(255,215,0,0.08);
  }
  
.top-tip,
.mobileMenuBtn,
#tempChatBtn{
  position:relative;
  z-index:2100;
}

.top-tip{
  width:44px;
  height:44px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  font-size:20px;
}
@media (max-width:600px){
  .modal{
    transform:none;
  }
  }
html.light .side{
  background:#ffffff;
  color:#111111;
}

  
html.light .side .small-muted{
  color:#555;
}

html.light .side .convo-item{
  background:#f3f3f3;
  color:#111;
}
.drop-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(8px);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  font-weight:700;
  color:white;
  opacity:0;
  pointer-events:none;
  transition:0.2s ease;
  z-index:999;
}

.drop-overlay.active{
  opacity:1;
  pointer-events:all;
}
@media (min-width:881px){
  #mobileMenuBtn{
    display:none !important;
  }
}
#z-overlay{
  display:none;
  position:fixed;
  inset:0;
  background:transparent; /* REMOVE DARKNESS */
  z-index:8000;
}

/* 1. Ensure the Button is White */

/* 2. The BLACK Triangle Head */
.arrow-up {
  width: 0; 
  height: 0; 
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-bottom: 9px solid #000 !important; /* FORCED BLACK */
  display: block;
  margin-bottom: -1px;
}

/* 3. The BLACK Stem */
.arrow-stem {
  width: 2px;
  height: 10px;
  background-color: #000 !important; /* FORCED BLACK */
  display: block;
  border-radius: 1px;
}

/* 4. GOD-TIER FLY-UP ANIMATION */
#sendBtn:active .arrow-up,
#sendBtn:active .arrow-stem {
  transform: translateY(-40px);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

/* ===== 2025 MODERN COMPOSE ===== */

.modern-compose{
  background: #000 !important;
  color: #fff;
  backdrop-filter: blur(18px);
  border-radius: 22px;
  padding: 8px 10px;
  display:flex;
  align-items:center;
  gap:10px;
}

.compose-tools{
  display:flex;
  gap:8px;
}

.tool-square,
.send-square{
  width:38px;
  height:38px;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  font-weight:700;
  border:none;
  cursor:pointer;
  transition: all 0.25s ease;
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(10px);
}

/* Hover physics */
.tool-square:hover,
.send-square:hover{
  transform: translateY(-2px);
  background: rgba(255,255,255,0.16);
  box-shadow: 0 8px 25px rgba(0,0,0,0.35);
}
.upload-spinner{
  width:18px;
  height:18px;
  border:3px solid rgba(255,255,255,0.2);
  border-top:3px solid #ffd54a;
  border-radius:50%;
  animation:spin 0.8s linear infinite;
  display:none;
}

@keyframes spin{
  to{ transform:rotate(360deg); }
}
/* Send special accent */
.send-square{
  background: linear-gradient(135deg, #f3d36b, #ffd54a);
  color:#000;
  font-size:16px;
}

.send-square:hover{
  box-shadow: 0 12px 30px rgba(255,215,0,0.45);
}

/* Clean textarea */
.modern-compose textarea{
  flex:1;
  border:none;
  background:transparent;
  resize:none;
  font-size:15px;
  padding:8px;
}

.modern-compose textarea:focus{
  outline:none;
}

/* ============================= */
/*   WORLD CLASS AI BUBBLE      */
/* ============================= */

.msg.ai{
  position:relative;
  background: linear-gradient(145deg, #0f1c28, #0a141d);
  border-left: 4px solid var(--accent-strong);
  border-radius: 18px;
  padding: 16px 18px;
  line-height: 1.6;
  font-size: 15.5px;
  letter-spacing: 0.2px;

  box-shadow:
    0 8px 30px rgba(0,0,0,0.35),
    inset 0 1px 0 rgba(255,255,255,0.03);

  backdrop-filter: blur(6px);
  transition: 
    transform .18s ease,
    box-shadow .18s ease,
    background .25s ease;
}

/* subtle glow edge */
.msg.ai::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:18px;
  pointer-events:none;
  box-shadow: 0 0 0 1px rgba(255,215,0,0.05);
}

/* Hover lift */
@media (hover:hover){
  .msg.ai:hover{
    transform: translateY(-2px);
    box-shadow:
      0 14px 45px rgba(0,0,0,0.5),
      0 0 0 1px rgba(255,215,0,0.08);
  }
}

/* Light mode polish */
html.light .msg.ai{
  background: linear-gradient(145deg, #ffffff, #f6f6f6);
  border-left: 4px solid var(--accent);
  box-shadow:
    0 8px 25px rgba(0,0,0,0.08),
    inset 0 1px 0 rgba(255,255,255,0.9);
}

/* Better paragraph spacing */
.msg.ai p{
  margin: 10px 0;
}

/* Headings stronger hierarchy */
.msg.ai h1{ font-size: 22px; }
.msg.ai h2{ font-size: 19px; }
.msg.ai h3{ font-size: 17px; }

.msg.ai h1,
.msg.ai h2,
.msg.ai h3{
  font-weight: 800;
  margin-top: 18px;
  margin-bottom: 10px;
}

/* Cleaner lists */
.msg.ai ul li::marker,
.msg.ai ol li::marker{
  color: var(--accent-strong);
}

/* Smoother blockquote */
.msg.ai blockquote{
  background: rgba(255,215,0,0.08);
  border-left: 4px solid var(--accent-strong);
  padding: 12px 16px;
  border-radius: 12px;
}

/* Table polish */
.msg.ai table{
  border-radius: 14px;
  overflow:hidden;
  font-size:14px;
}

/* Code block upgrade */
.msg.ai pre{
  border-radius: 14px;
  padding: 16px;
  font-size: 14px;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.05);
}

/* Inline code refined */
.msg.ai p code{
  border-radius: 8px;
  padding: 3px 7px;
  font-weight: 600;
}

/* Thinking state subtle fade */
.msg.ai.thinking{
  opacity: 0.75;
  transform: scale(0.99);
}  
/* ===== Plus floating panel & bottom sheet (clean, grid layout) ===== */
.plus-panel{
  position: fixed;
  /* sit centered horizontally between side and right edge */
  left: calc(var(--side-w) + 18px);
  right: 18px;
  bottom: 92px; /* above compose area */
  background: #000 !important;
  color: #ffffff !important;
  backdrop-filter: blur(18px);
  border-radius: 14px;
  padding: 12px;
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:12px;
  align-items:flex-start;
  justify-content:space-between;
  box-shadow: none; /* remove heavy black shadow for a cleaner look */
  transform-origin: bottom center;
  opacity:0;
  pointer-events:none;
  transform: translateY(8px) scale(.98);
  transition: all .18s cubic-bezier(.2,.9,.25,1);
  z-index:12000;
  border:1px solid rgba(255,255,255,0.04);
  flex-wrap:wrap; /* allow buttons to wrap into rows */
  max-width: calc(100% - var(--side-w) - 36px);
}
.plus-panel.active{
  opacity:1;
  pointer-events:all;
  transform: translateY(0) scale(1);
}

/* mode buttons become an even two-column grid */
.plus-panel .mode-btn{
  height:72px;
  border-radius:12px;
  display:flex;
  flex-direction:row;
  align-items:center;
  justify-content:flex-start;
  gap:12px;
  padding:10px;
  font-weight:800;
  background: rgba(255,255,255,0.02);
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.03);
  transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
}
.plus-panel .mode-btn span{ font-size:20px; display:block; }
.plus-panel .mode-btn div{ font-size:14px; color:var(--text); font-weight:700; text-transform:none; }

/* subtle hover */
.plus-panel .mode-btn:hover{
  transform: translateY(-6px);
  box-shadow: 0 10px 30px rgba(0,0,0,0.18);
  background: rgba(255,255,255,0.04);
}

/* mode pills (small selector) */
.plus-panel .modes {
  display:flex;
  gap:8px;
  align-items:center;
  margin-left:8px;
  width:100%;
  justify-content:flex-end;
}
.mode-pill{
  padding:6px 10px;
  border-radius:999px;
  background:rgba(255,255,255,0.02);
  font-size:12px;
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.03);
  color:var(--text);
}
.mode-pill.active{
  background: linear-gradient(90deg,#ffd54a,#f3d36b);
  color:#000;
  box-shadow: 0 10px 30px rgba(255,215,0,0.12);
}
/* ===== Scroll Down Button ===== */

.scroll-down-btn{
  position: absolute;
  right: 20px;
  bottom: 90px;
  width:40px;
  height:40px;
  border-radius:50%;
  border:none;
  background: linear-gradient(135deg,#f3d36b,#ffd54a);
  color:#000;
  font-size:18px;
  cursor:pointer;
  display:none;
  align-items:center;
  justify-content:center;
  box-shadow:0 8px 20px rgba(0,0,0,0.25);
  z-index:5000;
  transition: transform .2s ease;
}

.scroll-down-btn:hover{
  transform: translateY(-3px);
}
/* bottom sheet (half-screen) - visually light and clean */
.bottom-sheet{
  position:fixed;
  left:0;
  right:0;
  bottom:0;
  height:0;
  background: #000 !important;
  backdrop-filter: blur(20px);
  border-top-left-radius:20px;
  border-top-right-radius:20px;
  box-shadow: 0 -8px 25px rgba(0,0,0,0.08);
  transition: height .28s cubic-bezier(.2,.9,.25,1);
  overflow:hidden;
  z-index:16000;
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
  
.bottom-sheet.open{ height:46vh; padding-bottom: env(safe-area-inset-bottom); }

/* thumbnails */
.image-thumb{
  width:78px;
  height:78px;
  border-radius:10px;
  object-fit:cover;
  border:1px solid rgba(255,255,255,0.04);
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}
.thumb-row{ display:flex; gap:8px; align-items:center; }
  
/* compact upload status line */
.upload-status{ font-size:13px;color:var(--muted); display:flex; gap:10px; align-items:center; }

/* HARD REMOVE ANY DARK BOTTOM LAYER */
.bottom-sheet,
#z-overlay{
  display:none !important;
  background:transparent !important;
  box-shadow:none !important;
}

/* ===== PINK ACTIVE STATE FOR + BUTTON ===== */


.plus-active-bg {
  background: rgba(255, 105, 180, 0.12) !important;
  backdrop-filter: blur(8px);
  transition: background 0.25s ease;
}
html.dark .plus-active-bg {
  background: rgba(255, 105, 180, 0.12) !important;
}
  
/* FORCE PINK WHEN + IS ACTIVE */
.modern-compose{
  background: #ffffff !important;
  border-top: 1px solid rgba(0,0,0,0.06);
}

/* Dark mode version */
html.dark .modern-compose{
  background: #1a1a1a !important;
  border-top: 1px solid rgba(255,255,255,0.08);
}
.scroll-down-btn{
  position: fixed;
  right: 24px;
  bottom: 110px;
  display: none;
  z-index: 9999;
}
html, body {
  height: 100%;
}

.app {
  height: 100vh;
  overflow: hidden;   /* prevents whole page moving */
}

.main {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.chat-wrap {
  flex: 1;
  overflow-y: auto;   /* only chat scrolls */
}
/* Force readable text in dark mode */
html.dark .plus-panel,
html.dark .plus-panel * {
  color: #ffffff !important;
}
/* temp chats list */
.temp-list{display:flex;flex-direction:column;gap:8px;margin-top:12px}
.temp-entry{padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center}

</style>
  
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
  marked.setOptions({
    gfm: true,        // GitHub-style markdown (tables, task lists)
    breaks: true,    // Line breaks without double enter
    smartLists: true,
    smartypants: true
  });
</script>
  
<link rel="stylesheet"
 href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">

</head>
<body>
<header>
  <div style="display:flex;gap:12px;align-items:center">
    <div id="mobileMenuBtn" class="top-tip mobile-only">‚ò∞</div>
    <div style="display:flex;gap:12px;align-items:center">
      <div class="logo mobile-hidden" id="smallLogo">
        <span class="fire">Zult</span><span class="x-black">X</span>
      </div>
      <div class="small-muted" style="font-weight:700">ZultX ‚Äî v1.4</div>
    </div>

    <!-- temp chat 3/4 circle icon ‚Äî mobile-only -->
    <div id="tempChatBtn" class="temp-chat-icon mobile-only" title="Temporary chats">
      <!-- 3/4 circle SVG -->
      <svg viewBox="0 0 24 24" fill="none" width="22" height="22" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M12 2a10 10 0 1 0 10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="12" cy="12" r="9" fill="none" stroke="rgba(255,215,0,0.06)" stroke-width="2"/>
      </svg>
    </div>

    <div class="version-badge">v1.4</div>
  </div>
</header>

<!-- overlay for closing side/modals -->
<div id="z-overlay" aria-hidden="true"></div>

<div class="app">
  <aside class="side" id="sidePanel">
    <div style="display:flex;align-items:center;justify-content:space-between;">
      <div class="side-actions" id="sideActionsRow">
        <div id="sideTheme" class="side-btn" aria-label="Toggle theme">üåó</div>
        <div id="sideLetters" class="side-btn" aria-label="Letters">‚úâÔ∏è</div>
        <div id="sideTip" class="side-btn" aria-label="Tip">üçè</div>
        <div id="sideShare" class="side-btn" aria-label="Share">üîó</div>
      </div>
    </div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <div><strong>ZultX</strong><div class="small-muted">Your AI Assistant</div></div>
      <div class="small-muted" id="sideUserName">User</div>
    </div>

    <h3 style="margin-top:6px">Your Chats</h3>
    <div id="historyList" aria-live="polite"></div>
    <div style="height:12px"></div>
    <div class="menu-btn" id="newChatBtn">+ New chat</div>
    <div style="height:14px"></div>
    <div class="hint">Local history (stored in your browser). Hold / right-click an item to delete.</div>
  </aside>

  <main class="main">
    <div id="centerScreen" class="center-screen">
      <div class="center-inner">
        <div class="center-title">What can ZultX help with?</div>

        <div class="suggest-grid" id="suggestGrid"></div>

        <button id="startBtn" class="start-btn">Ask Something New</button>
      </div>
    </div>

    <div id="chatArea" class="chat-wrap" style="display:none" aria-live="polite"></div>

    <div class="compose">
      <div class="compose-inner modern-compose">
        <!-- LEFT TOOL SQUARES -->
        <div class="compose-tools">
          <button class="tool-square" id="plusBtn">+</button>
          <button class="tool-square" id="attachBtn">üìé</button>
        </div>
        <!-- INPUT -->
        <textarea id="input" placeholder="Ask ZultX..." rows="1"></textarea>
        <div id="tokenCounter" class="token-counter">0 tokens</div>
        <button id="scrollDownBtn" class="scroll-down-btn">‚Üì</button>
        <div id="dropOverlay" class="drop-overlay">
          Drop txt files here
        </div>
        <div id="uploadSpinner" class="upload-spinner"></div>
        <input type="file" id="fileInput" accept=".txt,image/*" style="display:none;" multiple>
        <!-- image & camera & video inputs (hidden) -->
        <input type="file" id="imageInput" accept="image/*" style="display:none;" multiple>
        <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none;">
        <input type="file" id="videoInput" accept="video/*" style="display:none;">
        <!-- SEND -->
        <button class="send-square" id="sendBtn">
          ‚Üë
        </button>
      </div>
    </div>
  </main>
</div>

<!-- Letters modal -->
<div id="lettersModal" class="modal sm" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h2>Letter</h2>
    <button id="closeLettersBtn">Close</button>
  </div>
  <pre id="modalLettersContent" style="white-space:pre-wrap;color:var(--text);margin-top:12px"></pre>
</div>

<!-- Tip modal -->
<div id="tipModal" class="modal sm" aria-hidden="true">
  <h3>Tip ZultX</h3>
  <div style="display:flex;gap:8px;margin-top:12px">
    <button onclick="createTip(10)">‚Çπ10</button>
    <button onclick="createTip(40)">‚Çπ40</button>
    <button onclick="createTip(100)">‚Çπ100</button>
    <button onclick="createTip(500)">‚Çπ500</button>
  </div>
  <div style="margin-top:12px"><button id="closeTipBtn">Cancel</button></div>
  <button id="copyUpiBtn" style="margin-top:8px">Copy UPI ‚Äî 9358588509@fam</button>
</div>

<!-- Temp chats modal -->
<div id="tempModal" class="modal" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h2>Temporary Chats</h2>
    <button id="closeTempBtn">Close</button>
  </div>
  <div style="margin-top:12px" class="small-muted">Temporary chats are not saved to history. Long-press or right-click to delete.</div>
  <div id="tempList" class="temp-list"></div>
</div>

<!-- PREMIUM UI -->
<div id="premiumAuth" class="premium-modal" aria-hidden="true">
  <div class="premium-card" role="dialog" aria-modal="true" id="premiumCard">
    <div class="premium-header">
      <div>
        <div class="premium-title">ZultX ‚Äî Account Access</div>
        <div class="premium-sub">Sign up or login to unlock saved memories & preferences. Try free without signup.</div>
      </div>
      <div>
        <button id="premiumClose" class="menu-btn">Close</button>
      </div>
    </div>

    <div class="premium-form" id="premiumFormArea">
      <input id="p_username" placeholder="Username" />
      <input id="p_email" placeholder="Email (signup only)" style="display:none;" />
      <div style="position:relative; display:flex; gap:8px; align-items:center;">
        <input id="p_password" type="password" placeholder="Password" style="flex:1;" />
        <button id="p_eye" class="pw-eye" title="Show/Hide password">üëÅ‚Äçüó®</button>
      </div>
      <div style="display:flex;gap:10px;align-items:center">
        <button id="p_submit" class="menu-btn">Login</button>
        <button id="p_toggle" class="menu-btn">Switch to Signup</button>
        <button id="p_guest" class="menu-btn" title="Try without login">Try without login</button>
        <div id="p_msg" class="small-muted" style="margin-left:8px"></div>
      </div>
    </div>
  </div>
</div>

<!-- libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>
/* ---------- Config & DOM refs ---------- */
const API_BASE = "https://zultx.onrender.com";
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

const overlay = document.getElementById('z-overlay');
const chatArea = document.getElementById("chatArea");
const input = document.getElementById("input");
const sendBtn = document.getElementById("sendBtn");
const startBtn = document.getElementById("startBtn");
const centerScreen = document.getElementById("centerScreen");
const historyList = document.getElementById("historyList");
const newChatBtn = document.getElementById("newChatBtn");
const suggestGrid = document.getElementById("suggestGrid");

const sidePanel = document.getElementById("sidePanel");
const mobileMenuBtn = document.getElementById("mobileMenuBtn");
const tempChatBtn = document.getElementById("tempChatBtn");
const tempModal = document.getElementById("tempModal");
const tempList = document.getElementById("tempList");
const closeTempBtn = document.getElementById("closeTempBtn");
const smallLogo = document.getElementById("smallLogo");

const sideTheme = document.getElementById("sideTheme");
const sideLetters = document.getElementById("sideLetters");
const sideTip = document.getElementById("sideTip");
const sideShare = document.getElementById("sideShare");

const lettersModal = document.getElementById("lettersModal");
const modalLettersContent = document.getElementById("modalLettersContent");
const closeLettersBtn = document.getElementById("closeLettersBtn");

const tipModal = document.getElementById("tipModal");
const closeTipBtn = document.getElementById("closeTipBtn");
const copyUpiBtn = document.getElementById("copyUpiBtn");

const premiumAuth = document.getElementById("premiumAuth");
const premiumClose = document.getElementById("premiumClose");
const p_username = document.getElementById("p_username");
const p_email = document.getElementById("p_email");
const p_password = document.getElementById("p_password");
const p_submit = document.getElementById("p_submit");
const p_toggle = document.getElementById("p_toggle");
const p_guest = document.getElementById("p_guest");
const p_eye = document.getElementById("p_eye");
const p_msg = document.getElementById("p_msg");
const plusBtn = document.getElementById("plusBtn");
const attachBtn = document.getElementById("attachBtn");
const fileInput = document.getElementById("fileInput");
  
plusBtn?.addEventListener("click", ()=>{
  alert("Tools panel (Preview only)");
});
  
let currentConversationId = null;
let tempMode = false;
let uploadedFileName = null;
let uploadedFiles = [];
let premiumMode = "login";
  
fileInput.setAttribute("multiple", "true");
fileInput.addEventListener("change", async () => {
  const files = Array.from(fileInput.files);
  if (!files.length) return;

  for (const file of files) {

    // ===== TXT FILES =====
    if (file.name.toLowerCase().endsWith(".txt")) {

      showUploadSpinner();

      const formData = new FormData();
      formData.append("file", file);

      const res = await fetch(`${API_BASE}/upload-txt`, {
        method: "POST",
        body: formData
      });

      const data = await res.json();

      hideUploadSpinner();

      if (!data.ok) {
        alert(data.error);
        continue;
      }

      uploadedFiles.push({
        name: data.filename,
        size: file.size,
        text: data.text,
        type: "text",
        tokens: estimateTokens(data.text)
      });
    }

    // ===== IMAGES =====
    else if (file.type.startsWith("image/")) {

      const url = URL.createObjectURL(file);

      uploadedFiles.push({
        name: file.name,
        size: file.size,
        url: url,
        type: "image",
        tokens: estimateImageTokens(file),
        local: true
      });
    }

    else {
      alert("Only .txt files and images are allowed üíô");
    }
  }

  renderFilePreview();
  fileInput.value = "";
});

function estimateTokens(text){
  return Math.ceil(text.length / 4);
}
  

const filePreviewContainer = document.createElement("div");
filePreviewContainer.className = "file-preview-container";
document.querySelector(".compose").prepend(filePreviewContainer);

attachBtn.addEventListener("click", () => {
  fileInput.click();
});

  
/* ---------- Safe helpers ---------- */
function $id(id){ return document.getElementById(id); }
function showOverlay(){ overlay.style.display = 'block'; overlay.setAttribute('aria-hidden','false'); }
function hideOverlay(){ overlay.style.display = 'none'; overlay.setAttribute('aria-hidden','true'); }

/* Close everything on overlay click (mobile UX) */
overlay.addEventListener('click', ()=> {
  closeAllSideModals();
});
function showUploadSpinner(){
  document.getElementById("uploadSpinner").style.display="block";
}

function hideUploadSpinner(){
  document.getElementById("uploadSpinner").style.display="none";
}
/* ---------- Theme logic (single source of truth) ---------- */
function applyInitialTheme(){
  const saved = localStorage.getItem('zultx_theme');
  if(saved === 'light') document.documentElement.className = 'light';
  else if(saved === 'dark') document.documentElement.className = 'dark';
  else {
    const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
    document.documentElement.className = prefersLight ? 'light' : 'dark';
  }
  updateThemeVisuals();
}
function toggleTheme(){
  const cur = document.documentElement.className === 'light' ? 'light' : 'dark';
  const next = cur === 'light' ? 'dark' : 'light';
  document.documentElement.className = next;
  localStorage.setItem('zultx_theme', next);
  updateThemeVisuals();
}
function updateThemeVisuals(){
  const isLight = document.documentElement.className === 'light';
  // sideTheme button icon
  if(sideTheme) sideTheme.textContent = isLight ? 'üåû' : 'üåô';
  // temp mini theme inside the small circle on mobile
  // code block highlighting re-check if present
}
sideTheme && sideTheme.addEventListener('click', toggleTheme);
applyInitialTheme();

/* ---------- Mobile menu toggle ---------- */
mobileMenuBtn && mobileMenuBtn.addEventListener('click', ()=>{
  sidePanel.classList.toggle('open');
  if(sidePanel.classList.contains('open')) showOverlay(); else hideOverlay();
});

function updateTokenDisplay(){
  const inputTokens = estimateTokens(input.value);
  const fileTokens = uploadedFiles.reduce((a,b)=>a+b.tokens,0);
  const total = inputTokens + fileTokens;

  document.getElementById("tokenCounter").textContent =
    `${total} tokens total`;
}

input.addEventListener("input", updateTokenDisplay);

function estimateImageTokens(file){
  // simple token estimate for images
  return Math.ceil(file.size / 1000);
}
  
/* ---------- Temp button behavior (mobile-only) ---------- */
function updateTempVisibility(){
  if(!tempChatBtn) return;

  const hasMessages = !!chatArea.querySelector('.msg');

  if(hasMessages){
    tempChatBtn.style.display = 'none';
  } else {
    tempChatBtn.style.display = 'flex';
  }
}

tempChatBtn && tempChatBtn.addEventListener('click', ()=>{
  // open modal or start temp chat
  populateTempList();
  tempModal.style.display = 'block';
  showOverlay();
});
async function sendMessageFromSuggestion(text){
  if(!text) return;

  if(!currentConversationId){
    currentConversationId = makeConvoId();
    localSaveInit(currentConversationId);
  }

  addUserMsg(text);

  sendBtn.disabled = true;

  let aiDiv = document.createElement('div');
  aiDiv.className = 'msg ai thinking';
  aiDiv.innerHTML = `<div class="ai-pulse"></div>`;
  chatArea.appendChild(aiDiv);

  try{
    const token = getToken();
    const sessionId = ensureSessionId();
    const headers = { "Accept":"application/json", "X-Session-Id": sessionId };
    if(token) headers["Authorization"] = "Bearer " + token;

    const res = await fetch(`${API_BASE}/ask?q=${encodeURIComponent(text)}&source=suggestion`, {
      method:"GET",
      headers
    });

    if(!res.ok) throw new Error("Server error");

    const data = await res.json();
    const answer = data?.answer || "No response.";

    aiDiv.classList.remove("thinking");
    fakeStream(aiDiv, answer, 0);

    saveMessageToHistory(currentConversationId, 'ai', answer);

  } catch(err){
    console.error(err);
    aiDiv.classList.remove("thinking");
    aiDiv.textContent = "‚ö†Ô∏è Connection error.";
  } finally {
    sendBtn.disabled = false;
  }
}


/* start a fresh temporary chat (not saved) */
function createTempConversation(){
  tempMode = true;
  currentConversationId = makeConvoId('temp');
  chatArea.innerHTML = '';
  centerScreen.style.display = 'none';
  chatArea.style.display = 'flex';
  addSystemMsg('Temporary chat started (will not be saved).');
  updateTempVisibility();
}
async function loadSuggestions() {
  const grid = document.getElementById("suggestGrid");
  grid.innerHTML = "Loading suggestions...";

  try {
    const token = localStorage.getItem("zultx_token");
    const headers = token ? { Authorization: "Bearer " + token } : {};

    const res = await fetch(`${API_BASE}/suggestions`, { headers });
    const data = await res.json();

    grid.innerHTML = "";

    data.suggestions.forEach(text => {
      const card = document.createElement("div");
      card.className = "suggest-card";
      card.innerText = text;

      card.onclick = () => {
        centerScreen.style.display = 'none';
        chatArea.style.display = 'flex';
        currentConversationId = makeConvoId();
        localSaveInit(currentConversationId);
        sendMessageFromSuggestion(text);
};

     grid.appendChild(card);
    });

  } catch (err) {
    grid.innerHTML = "Could not load suggestions.";
  }
}
/* helper used by side button mapping */
function startTemporaryChat(){
  // mobile- and desktop-consistent entrypoint for temporary chats
  // on desktop we push a temp conversation but also show a toast hint
  createTempConversation();
  tempModal.style.display = 'none';
  hideOverlay();
}

/* populate temp list ‚Äî temp-conversations are saved under 'temp_' to local history if you choose to persist them */
function populateTempList(){
  tempList.innerHTML = '';
  const all = getAllHistory();
  const tempKeys = Object.keys(all).filter(k => k.startsWith('temp_')).sort((a,b)=> all[b].created - all[a].created);

  const newBtn = document.createElement('div');
  newBtn.className = 'menu-btn';
  newBtn.textContent = '+ New temporary chat';
  newBtn.onclick = ()=> { createTempConversation(); tempModal.style.display='none'; hideOverlay(); };
  tempList.appendChild(newBtn);

  if(tempKeys.length === 0){
    const p = document.createElement('div'); p.className='small-muted'; p.textContent='No temporary chats found (they are not saved by default).';
    tempList.appendChild(p);
    return;
  }

  for(const k of tempKeys){
    const entry = all[k];
    const el = document.createElement('div');
    el.className = 'temp-entry';
    el.innerHTML = `<div style="display:flex;flex-direction:column"><strong>${entry.id}</strong><div class="small-muted">${entry.messages && entry.messages.length ? entry.messages[entry.messages.length-1].text.slice(0,60) : 'Empty'}</div></div><div style="display:flex;gap:8px"><button data-id="${k}" class="open-temp">Open</button><button data-id="${k}" class="del-temp">Delete</button></div>`;
    tempList.appendChild(el);
  }

  tempList.querySelectorAll('.open-temp').forEach(btn=>{
    btn.onclick = ()=> {
      const id = btn.dataset.id;
      tempMode = true;
      currentConversationId = id;
      const convo = loadConversation(id);
      chatArea.innerHTML = '';
      centerScreen.style.display = 'none';
      chatArea.style.display = 'flex';
      if(convo && convo.messages) convo.messages.forEach(m=> addBubble(m.role === 'user' ? 'user' : 'ai', m.text, false));
      tempModal.style.display = 'none';
      hideOverlay();
      updateTempVisibility();
    };
  });
  tempList.querySelectorAll('.del-temp').forEach(btn=>{
    btn.onclick = async ()=>{
      const id = btn.dataset.id;
      if(!confirm("Delete this temporary chat?")) return;
      const al = getAllHistory();
      delete al[id];
      setAllHistory(al);
      populateTempList();
      refreshHistoryList();
    };
  });
}

/* close temp modal */
closeTempBtn && closeTempBtn.addEventListener('click', ()=> { tempModal.style.display = 'none'; hideOverlay(); });

function renderFilePreview(){
  filePreviewContainer.innerHTML = "";

  uploadedFiles.forEach((file, index) => {
    const sizeKB = (file.size / 1024).toFixed(1);

    const pill = document.createElement("div");
    pill.className = "file-pill";

    if(file.type === 'image'){
      pill.innerHTML = `
        <img src="${file.url}" class="image-thumb" alt="${file.name}" style="margin-right:8px">
        <div style="display:flex;flex-direction:column;gap:4px">
          <div style="font-weight:700">${file.name}</div>
          <div style="font-size:12px;color:var(--muted)">${sizeKB} KB ‚Ä¢ ${file.tokens} tokens</div>
        </div>
        <div style="margin-left:auto"><button data-index="${index}">‚úï</button></div>
      `;
    } else {
      pill.innerHTML = `
        üìÑ ${file.name} (${sizeKB} KB ‚Ä¢ ${file.tokens} tokens)
        <button data-index="${index}">‚úï</button>
      `;
    }

    filePreviewContainer.appendChild(pill);
  });

  document.querySelectorAll(".file-pill button").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const i = Number(btn.getAttribute("data-index"));
      uploadedFiles.splice(i,1);
      renderFilePreview();
    });
  });

  updateTokenDisplay();
}
  
/* ---------- Letters / Tips / Share functions (wired to side buttons) ---------- */
function openLettersModal(){
  lettersModal.style.display = 'block';
  showOverlay();
  loadLetters();
}
async function loadLetters(){
  try{
    const res = await fetch(`${API_BASE}/letters`);
    if(!res.ok) { modalLettersContent.textContent = 'No letters'; return; }
    const data = await res.json();
    const name = (data.letters && data.letters.length) ? data.letters[0] : null;
    if(!name) { modalLettersContent.textContent = 'No letters found'; return; }
    const r2 = await fetch(`${API_BASE}/letters/` + encodeURIComponent(name));
    const text = await r2.text();
    modalLettersContent.textContent = text;
  }catch(e){ modalLettersContent.textContent = 'Unable to load letters'; console.error(e); }
}
closeLettersBtn && closeLettersBtn.addEventListener('click', ()=> { lettersModal.style.display='none'; hideOverlay(); });

function openTipModal(){
  tipModal.style.display = 'block';
  showOverlay();
}
closeTipBtn && closeTipBtn.addEventListener('click', ()=> { tipModal.style.display='none'; hideOverlay(); });

copyUpiBtn && (copyUpiBtn.onclick = async ()=> {
  try{
    await navigator.clipboard.writeText('9358588509@fam');
    alert('UPI copied: 9358588509@fam');
  }catch(e){
    alert('Copy failed. UPI: 9358588509@fam');
  }
});

function shareChat(){
  const shareData = { title: 'ZultX AI', text: 'ZultX ‚Äî Fast, Adaptive Reasoning AI. Try it now.', url: 'https://zultx.github.io/ZultX-v2/' };
  if(navigator.share){
    navigator.share(shareData).catch(()=>{});
  } else {
    navigator.clipboard.writeText(shareData.url).then(()=> alert('Link copied!')).catch(()=> prompt('Copy & share this link:', shareData.url));
  }
}

/* wire side buttons safely */
sideLetters && sideLetters.addEventListener('click', openLettersModal);
sideTip && sideTip.addEventListener('click', openTipModal);
sideShare && sideShare.addEventListener('click', shareChat);

/* ---------- History storage helpers ---------- */
function makeConvoId(prefix='convo'){ return `${prefix}_${Date.now()}`; }
function getAllHistory(){
  try{ return JSON.parse(localStorage.getItem('zultx_history') || '{}'); } catch(e){ return {}; }
}
function setAllHistory(obj){ localStorage.setItem('zultx_history', JSON.stringify(obj)); }

const dropOverlay = document.getElementById("dropOverlay");

window.addEventListener("dragover", e=>{
  e.preventDefault();
  dropOverlay.classList.add("active");
});

window.addEventListener("dragleave", e=>{
  if(e.clientX === 0 && e.clientY === 0){
    dropOverlay.classList.remove("active");
  }
});

window.addEventListener("drop", async e=>{
  e.preventDefault();
  dropOverlay.classList.remove("active");

  const files = Array.from(e.dataTransfer.files);
  fileInput.files = e.dataTransfer.files;
  fileInput.dispatchEvent(new Event("change"));
});
  
function refreshHistoryList(){
  const all = getAllHistory();
  const keys = Object.keys(all).sort((a,b)=> all[b].created - all[a].created);
  historyList.innerHTML = '';

  for(const k of keys){
    const item = all[k];

    // üî• GOD-TIER TITLE LOGIC
    const firstUserMsg =
      item.messages?.find(m => m.role === 'user')?.text || '';

    const title =
      firstUserMsg.length > 36
        ? firstUserMsg.slice(0,36) + '‚Ä¶'
        : firstUserMsg || 'New Chat';

    // Optional: preview line (last message)
    const last =
      item.messages?.[item.messages.length - 1] || null;

    const preview =
      last?.text?.length > 48
        ? last.text.slice(0,48) + '‚Ä¶'
        : last?.text || 'New chat';

    const el = document.createElement('div');
    el.className = 'history-item';

    el.innerHTML = `
      <div style="display:flex;flex-direction:column;gap:6px">
        <div style="font-weight:700">${title}</div>
        <div class="meta">${preview}</div>
      </div>
      <div class="small-muted">
        ${new Date(item.created).toLocaleString()}
      </div>
    `;

    el.onclick = ()=> openConversation(k);

    el.oncontextmenu = (e)=> {
      e.preventDefault();
      confirmAndDelete(k);
    };

    el.addEventListener('touchstart', ()=>{
      this.pressTimer = setTimeout(()=> confirmAndDelete(k), 650);
    }, {passive:true});

    el.addEventListener('touchend', ()=>{
      clearTimeout(this.pressTimer);
    }, {passive:true});

    historyList.appendChild(el);
  }
}


/* ---------- messaging UI helpers ---------- */
function addBubble(kind, text, stream = true){
  const d = document.createElement('div');
  d.className = 'msg ' + (kind === 'user' ? 'user' : 'ai');
  if(kind === 'ai'){
    if(stream) fakeStream(d, text, 2);
    else { d.innerHTML = marked.parse(text); d.querySelectorAll("pre code").forEach(b => hljs.highlightElement(b)); enhanceCodeBlocks(d); }
  } else {
    d.textContent = text;
  }
  chatArea.appendChild(d);
  chatArea.scrollTop = chatArea.scrollHeight;
}
function addUserMsg(text){
  addBubble('user', text);
  saveMessageToHistory(currentConversationId, 'user', text);
  updateTempVisibility();
}
function addAiMsg(text){
  addBubble('ai', text);
  saveMessageToHistory(currentConversationId, 'ai', text);
  updateTempVisibility();
}
function addSystemMsg(text){
  const d = document.createElement('div');
  d.style.textAlign='center'; d.style.color='var(--muted)'; d.textContent = text;
  chatArea.appendChild(d); chatArea.scrollTop = chatArea.scrollHeight;
}

function fakeStream(element, fullText, speed = 10) {
  element.innerHTML = "";
  let i = 0;
  function type() {
    if (i < fullText.length) {
      element.textContent += fullText[i++];
      chatArea.scrollTop = chatArea.scrollHeight;
      setTimeout(type, speed);
    } else {
      element.innerHTML = marked.parse(fullText);
      element.querySelectorAll("pre code").forEach(block => hljs.highlightElement(block));
      enhanceCodeBlocks(element);
    }
  }
  type();
}

function enhanceCodeBlocks(container){
  container.querySelectorAll('pre code').forEach(block => {
    const pre = block.parentElement;
    if(pre.classList.contains('code-enhanced')) return;
    pre.classList.add('code-enhanced');
    const className = block.className || '';
    const match = className.match(/language-(\w+)/);
    pre.setAttribute('data-lang', match ? match[1].toUpperCase() : 'CODE');
    const btn = document.createElement('button');
    btn.textContent = 'Copy';
    btn.className = 'copy-btn';
    btn.onclick = () => { navigator.clipboard.writeText(block.innerText); btn.textContent = 'Copied'; setTimeout(()=>btn.textContent='Copy',1500); };
    pre.style.position = 'relative';
    pre.appendChild(btn);
  });
}

/* ---------- history save/load ---------- */
function saveMessageToHistory(convoId, role, text){
  if(tempMode) return;
  const all = getAllHistory();
  all[convoId] = all[convoId] || { id: convoId, created: Date.now(), messages: [] };
  all[convoId].messages.push({ role, text, t: Date.now() });
  setAllHistory(all);
  refreshHistoryList();
}
function loadConversation(convoId){
  const all = getAllHistory();
  return all[convoId] || null;
}
function localSaveInit(convoId){
  const all = getAllHistory();
  if(!all[convoId]) all[convoId] = { id: convoId, created: Date.now(), messages: [] };
  setAllHistory(all);
}

function showUploadSpinner(){
  document.getElementById('uploadSpinner').style.display = 'block';
}

function hideUploadSpinner(){
  document.getElementById('uploadSpinner').style.display = 'none';
}
  
/* ---------- Streaming sendMessage() ---------- */
async function sendMessage(){
  const text = input.value.trim();
  if(!text) return;
  centerScreen.style.display = 'none'; chatArea.style.display = 'flex';
  if(!currentConversationId){
    currentConversationId = makeConvoId();
    localSaveInit(currentConversationId);
  }
  addUserMsg(text);
  input.value = '';
  sendBtn.disabled = true;

  let aiDiv = document.createElement('div'); aiDiv.className = 'msg ai thinking'; aiDiv.innerHTML = `<div class="ai-pulse"></div>`;
  chatArea.appendChild(aiDiv);
  try{
    const token = getToken();
    const sessionId = ensureSessionId();
    const headers = { "Accept":"application/json", "X-Session-Id": sessionId };
    if(token) headers["Authorization"] = "Bearer " + token;
    let finalMessage = text;
    if (uploadedFiles.length > 0) {
      const combinedFiles = uploadedFiles.map(f =>
        `File: ${f.name}\n${f.text}`
      ).join("\n\n");
      finalMessage = `
      User message:
      ${text}
      Attached files:
      ${combinedFiles}
      `;
}
    const res = await fetch(`${API_BASE}/ask?q=${encodeURIComponent(finalMessage)}`, { method:"GET", headers });
    if(!res.ok) throw new Error('Server error');
    const data = await res.json();
    const answer = data?.answer || "No response.";
    aiDiv.classList.remove("thinking");
    fakeStream(aiDiv, answer, 0);
    saveMessageToHistory(currentConversationId, 'ai', answer);
  }catch(err){
    console.error(err);
    aiDiv.textContent = "‚ö†Ô∏è Connection error.";
  }finally{ renderFilePreview(); updateTokenDisplay(); sendBtn.disabled = false; updateTempVisibility(); }
}
  
/* ---------- Open / New conversation ---------- */
startBtn && startBtn.addEventListener('click', ()=> {
  tempMode = false;
  currentConversationId = makeConvoId();
  localSaveInit(currentConversationId);
  chatArea.innerHTML = '';
  centerScreen.style.display = 'none';
  chatArea.style.display = 'flex';
  addSystemMsg('New chat started.');
  updateTempVisibility();
  refreshHistoryList();
});
newChatBtn && newChatBtn.addEventListener('click', ()=> {
  tempMode = false;
  currentConversationId = makeConvoId();
  localSaveInit(currentConversationId);
  chatArea.innerHTML = '';
  centerScreen.style.display = 'none';
  chatArea.style.display = 'flex';
  addSystemMsg('New chat started.');
  updateTempVisibility();
  refreshHistoryList();
});
function openConversation(convoId){
  tempMode = false;
  currentConversationId = convoId;
  const convo = loadConversation(convoId);
  chatArea.innerHTML = '';
  centerScreen.style.display = 'none';
  chatArea.style.display = 'flex';
  if(convo && convo.messages) for(const m of convo.messages) addBubble(m.role === 'user' ? 'user' : 'ai', m.text, false);
  updateTempVisibility();
}

function confirmAndDelete(convoId){
  if(!confirm("Delete this chat forever?")) return;
  const all = getAllHistory();
  if(all[convoId]) delete all[convoId];
  setAllHistory(all);
  refreshHistoryList();
  if(currentConversationId === convoId){
    currentConversationId = null;
    chatArea.innerHTML = '';
    centerScreen.style.display = 'flex';
    chatArea.style.display = 'none';
  }
}

/* ---------- Bind send & enter behavior ---------- */
sendBtn && sendBtn.addEventListener('click', sendMessage);
input && input.addEventListener('keydown', function(e) {
  if(e.key === "Enter"){
    if(e.shiftKey) return;
    if(isMobile) return;
    e.preventDefault();
    sendMessage();
  }
});
input && input.addEventListener("input", ()=> { input.style.height = "auto"; const maxHeight = 100; input.style.height = Math.min(input.scrollHeight, maxHeight) + "px"; });

/* init: ensure conversation */
if(!currentConversationId){ currentConversationId = makeConvoId(); localSaveInit(currentConversationId); }
refreshHistoryList();
centerScreen.style.display = 'flex';
chatArea.style.display = 'none';
updateTempVisibility();

/* ---------- Premium UX improvements ---------- */
function openPremium(mode='login'){
  premiumMode = mode;
  p_email.style.display = mode === 'signup' ? 'block' : 'none';
  p_submit.textContent = mode === 'signup' ? 'Create account' : 'Login';
  p_toggle.textContent = mode === 'signup' ? 'Switch to Login' : 'Switch to Signup';
  p_msg.textContent = '';
  p_username.value = ''; p_password.value = '';
  premiumAuth.style.display = 'flex'; premiumAuth.classList.add('active');
}
function closePremium(){
  premiumAuth.classList.remove('active'); premiumAuth.style.display = 'none';
  hideOverlay();
}
premiumClose && premiumClose.addEventListener('click', closePremium);
p_toggle && p_toggle.addEventListener('click', ()=> openPremium(p_toggle.textContent.includes('Signup') ? 'signup' : 'login'));
p_guest && p_guest.addEventListener('click', ()=> { ensureSessionId(); closePremium(); p_msg.textContent = 'Guest session active'; setTimeout(()=> p_msg.textContent = '',1500); });
p_eye && p_eye.addEventListener('click', ()=> { if(p_password.type === 'password'){ p_password.type='text'; p_eye.textContent='‚äò'; } else { p_password.type='password'; p_eye.textContent='üëÅÔ∏è'; } });

async function checkUsernameAvailable(un){
  try{
    const r = await fetch(`${API_BASE}/check_username?username=${encodeURIComponent(un)}`);
    if(!r.ok) return false;
    const d = await r.json();
    return !!d.available;
  }catch(e){ return false; }
}

p_submit && p_submit.addEventListener('click', async ()=>{
  const u = p_username.value.trim(); const pass = p_password.value; const em = p_email.value.trim();
  if(!u || !pass){ p_msg.textContent = 'username & password required'; return; }
  if(premiumMode === 'signup'){ p_msg.textContent = 'Checking availability...'; const ok = await checkUsernameAvailable(u); if(!ok){ p_msg.textContent = 'Username not available'; return; } }
  p_msg.textContent = 'Contacting server...';
  const url = premiumMode === 'signup' ? `${API_BASE}/signup` : `${API_BASE}/login`;
  const body = premiumMode === 'signup' ? { username:u, password:pass, email:em } : { username:u, password:pass };
  try{
    const res = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
    const data = await res.json();
    if(!res.ok || !data.ok){ p_msg.textContent = data.error || 'Auth failed'; return; }
    setToken(data.token);
    localStorage.setItem('zultx_username', data.user.username);
    p_msg.textContent = 'Welcome!';
    setTimeout(()=> { p_msg.textContent=''; closePremium(); refreshAccountUI(); }, 900);
  }catch(err){ console.error(err); p_msg.textContent = 'Network error'; }
});

/* popup close on ESC */
document.addEventListener('keydown', (e)=> {
  if(e.key === 'Escape'){ closeAllSideModals(); closePremium(); }
});

/* utility to close all open side modals/panels */
function closeAllSideModals(){
  tempModal.style.display='none';
  lettersModal.style.display='none';
  tipModal.style.display='none';
  sidePanel.classList.remove('open');
  hideOverlay();
}

/* ---------- Auth helpers (same as before) ---------- */
function ensureSessionId(){
  let sid = localStorage.getItem('zultx_session');
  if(!sid){ sid = 'sess_' + Math.random().toString(36).slice(2) + '_' + Date.now(); localStorage.setItem('zultx_session', sid); }
  return sid;
}
function setToken(token){ if(token) localStorage.setItem('zultx_token', token); else localStorage.removeItem('zultx_token'); }
function getToken(){ return localStorage.getItem('zultx_token'); }
function loggedIn(){ return !!getToken(); }

/* account row creation */
(function addLeftAccountRow(){
  const side = document.querySelector('.side');
  if(!side) return;
  const row = document.createElement('div');
  row.className = 'account-row';
  row.innerHTML = `<div><div style="font-weight:800">Account</div><div class="account-welcome" id="accWelcome">Not signed in</div></div><div><button id="accBtn" class="account-btn login">Login</button></div>`;
  side.insertBefore(row, side.firstChild);
  const accBtn = document.getElementById('accBtn');
  accBtn && accBtn.addEventListener('click', ()=>{
    if(loggedIn()){
      if(confirm("Log out?")){ setToken(null); localStorage.removeItem('zultx_username'); refreshAccountUI(); p_msg.textContent = 'Logged out'; setTimeout(()=> p_msg.textContent='',1500); }
    } else openPremium('login');
  });
})();
  
function refreshAccountUI(){
  const btn = document.getElementById('accBtn');
  const welcome = document.getElementById('accWelcome');
  const sideName = document.getElementById('sideUserName');

  const username = localStorage.getItem('zultx_username');

  if(loggedIn()){
    btn.classList.remove('login');
    btn.classList.add('logout');
    btn.textContent = 'Logout';

    welcome.textContent = 'Welcome ‚Äî ' + (username || 'User');
    if(sideName) sideName.textContent = username || 'User';
  } else {
    btn.classList.add('login');
    btn.classList.remove('logout');
    btn.textContent = 'Login';

    welcome.textContent = 'Not signed in';
    if(sideName) sideName.textContent = 'User';
    
  }
}

/* ===== PLUS PANEL UI (clean grid + click-outside close) ===== */
(function setupPlusPanel(){
  // create panel and bottom-sheet (clean grid)
  const plusPanel = document.createElement('div');
  plusPanel.id = 'plusPanel';
  plusPanel.className = 'plus-panel';
  plusPanel.innerHTML = `
    <button class="mode-btn" id="cameraBtn" title="Open camera">
      <span>üì∑</span>
      <div>Camera</div>
    </button>
    <button class="mode-btn" id="videoBtn" title="Video (soon)">
      <span>üéûÔ∏è</span>
      <div>Video</div>
    </button>
    <div class="modes" aria-hidden="true">
      <div class="mode-pill" data-mode="concise">Concise</div>
      <div class="mode-pill" data-mode="creative">Creative</div>
      <div class="mode-pill" data-mode="technical">Technical</div>
    </div>
  `;
  // insert into document near compose tools
  const composeInner = document.querySelector('.compose-inner');
  composeInner && composeInner.appendChild(plusPanel);

  // bottom-sheet (re-usable)
  const bottomSheet = document.getElementById('plusBottomSheet') || (function createSheet(){
    const bs = document.createElement('div');
    bs.id = 'plusBottomSheet';
    bs.className = 'bottom-sheet';
    bs.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:800">Uploads</div>
        <button id="closeSheet" class="menu-btn">Close</button>
      </div>
      <div id="thumbArea" class="thumb-row"></div>
      <div id="uploadStatus" class="upload-status">No recent uploads</div>
    `;
    document.body.appendChild(bs);
    return bs;
  })();

  // open/close behavior (toggle panel & bottom sheet)
  function closePlusPanel(){
    plusPanel.classList.remove('active');
    bottomSheet.classList.remove('open');
    hideOverlay();
  }

  function openPlusPanel(){
    plusPanel.classList.add('active');
    // keep bottomSheet closed unless we actually upload images
    // but show minimal overlay so user can click out
    showOverlay();
    // keep overlay click to close
  }

  plusBtn.addEventListener('click', (e)=>{
    e.stopPropagation();

    plusBtn.classList.toggle("plus-active-bg");

    if(plusPanel.classList.contains('active')) {
      closePlusPanel();
    } else {
      openPlusPanel();
    }
  });

  // close panel when clicking outside
  document.addEventListener('click', (ev)=>{
    if(!plusPanel.contains(ev.target) && ev.target !== plusBtn && !plusBtn.contains(ev.target)){
      closePlusPanel();
    }
  });

  // close on overlay click too (overlay already used by other modals)
  document.getElementById('z-overlay')?.addEventListener('click', closePlusPanel);

  // modes (visual only)
  plusPanel.querySelectorAll('.mode-pill').forEach(p=>{
    p.addEventListener('click', (ev)=>{
      plusPanel.querySelectorAll('.mode-pill').forEach(x=>x.classList.remove('active'));
      p.classList.add('active');
      // small toast
      const t = document.createElement('div');
      t.textContent = `${p.dataset.mode} mode selected (preview only)`;
      t.style.cssText = 'position:fixed;bottom:120px;left:calc(var(--side-w) + 22px);padding:10px 14px;border-radius:10px;background:rgba(0,0,0,0.75);color:#fff;z-index:19000;font-weight:700';
      document.body.appendChild(t);
      setTimeout(()=> t.remove(), 1200);
    });
  });

  // wire camera / image / video buttons
  const cameraInput = document.getElementById('cameraInput');
  const videoInput = document.getElementById('videoInput');

  // helper to close panel and stop propagation
  function preActionClose(e){
    if(e && e.stopPropagation) e.stopPropagation();
    closePlusPanel();
  }

  plusPanel.querySelector('#cameraBtn').addEventListener('click', (e)=> {
    preActionClose(e);
    cameraInput.value = '';
    cameraInput.click();
  });


  plusPanel.querySelector('#videoBtn').addEventListener('click', (e)=> {
    preActionClose(e);
    alert('Video uploading coming soon ‚Äî watch this space!');
  });

  // show/hide bottom sheet: close button
  bottomSheet.querySelector('#closeSheet')?.addEventListener('click', ()=> {
    bottomSheet.classList.remove('open');
    hideOverlay();
  });

  // handle camera capture / image change ‚Äî reuse existing handlers but ensure sheet opens
  cameraInput.addEventListener('change', async (ev)=>{
    const file = ev.target.files && ev.target.files[0];
    if(!file) return;
    bottomSheet.classList.add('open');
    showUploadSpinner();
    // call your same handler locally (copied behavior)
    await (async function handleImageFile_local(file){
      try{
        const form = new FormData();
        form.append('image', file);
        const res = await fetch(`${API_BASE}/upload-image`, { method:'POST', body: form });
        if(res.ok){
          const data = await res.json();
          uploadedFiles.push({
            name: data.filename || file.name,
            size: file.size,
            url: data.url || '',
            type: 'image',
            tokens: estimateImageTokens(file)
          });
          document.getElementById('uploadStatus').textContent = `Uploaded ${file.name}`;
        } else {
          throw new Error('Upload failed');
        }
      } catch(err){
        const url = URL.createObjectURL(file);
        uploadedFiles.push({
          name: file.name,
          size: file.size,
          url,
          type: 'image',
          tokens: estimateImageTokens(file),
          local:true
        });
        document.getElementById('uploadStatus').textContent = `Preview added: ${file.name} (local)`;
      } finally {
        hideUploadSpinner();
        renderFilePreview();
        populateThumbs();
      }
    })(file);
  });

  // thumbnail population function for bottomSheet (keeps in-sync)
  function populateThumbs(){
    const area = document.getElementById('thumbArea');
    if(!area) return;
    area.innerHTML = '';
    uploadedFiles.filter(f=> f.type === 'image').forEach((f,i)=>{
      const img = document.createElement('img');
      img.className = 'image-thumb';
      img.src = f.url || (f.local ? f.url : '');
      img.alt = f.name;
      const wrapper = document.createElement('div');
      wrapper.style.display='flex';
      wrapper.style.flexDirection='column';
      wrapper.style.alignItems='center';
      wrapper.style.gap='6px';
      const btn = document.createElement('button');
      btn.textContent='‚úï';
      btn.style.fontSize='12px';
      btn.style.border='none';
      btn.style.background='transparent';
      btn.style.color='var(--muted)';
      btn.addEventListener('click', ()=> {
        uploadedFiles.splice(i,1);
        renderFilePreview();
        populateThumbs();
      });
      wrapper.appendChild(img);
      wrapper.appendChild(btn);
      area.appendChild(wrapper);
    });
  }

  // expose small helper to global scope for re-use if needed
  window.populateThumbs = populateThumbs;

})();
  
refreshAccountUI();
loadSuggestions();
  
/* ---------- small helpers: click outside chat area closes side on mobile (improve UX) ---------- */
chatArea.addEventListener("scroll", () => {
  const isNearBottom =
    chatArea.scrollHeight - chatArea.scrollTop - chatArea.clientHeight < 100;

  if(!isNearBottom){
    scrollDownBtn.style.display = "flex";
  } else {
    scrollDownBtn.style.display = "none";
  }
});

const scrollDownBtn = document.getElementById("scrollDownBtn");

function toggleScrollButton(){
  const nearBottom =
    chatArea.scrollHeight - chatArea.scrollTop - chatArea.clientHeight < 80;

  scrollDownBtn.style.display = nearBottom ? "none" : "flex";
}

chatArea.addEventListener("scroll", toggleScrollButton);

scrollDownBtn.addEventListener("click", ()=>{
  chatArea.scrollTo({
    top: chatArea.scrollHeight,
    behavior: "smooth"
  });
});

  
document.addEventListener('click', (e)=> {
  // if side is open and click outside sidePanel on mobile -> close
  if(sidePanel.classList.contains('open') && isMobile){
    if(!sidePanel.contains(e.target) && !mobileMenuBtn.contains(e.target)){
      sidePanel.classList.remove('open');
      hideOverlay();
    }
  }
});

/* ---------- bootstrap done ---------- */
console.log('ZultX UI loaded ‚Äî tidy & robust.');
</script>
</body>
</html>
